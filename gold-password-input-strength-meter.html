<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../paper-input/paper-input-addon-behavior.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<script src="../zxcvbn/dist/zxcvbn.js"></script>
<!--
`<gold-password-input-strength-meter>` is a password strength meter for use with
`<gold-password-input>`. It shows the strength of the password entered in the input.

### Styling

The following mixin is available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--gold-password-input-strength-meter-none-color` | The text color for a strength value of None  | `--paper-red-700`
`--gold-password-input-strength-meter-veryweak-color` | The text color for a strength value of Very Weak  | `--paper-red-700`
`--gold-password-input-strength-meter-weak-color` | The text color for a strength value of Weak  | `--paper-orange-700`
`--gold-password-input-strength-meter-medium-color` | The text color for a strength value of Medium  | `--paper-yellow-700`
`--gold-password-input-strength-meter-strong-color` | The text color for a strength value of Strong  | `--paper-blue-700`
`--gold-password-input-strength-meter-verystrong-color` | The text color for a strength value of Very Strong  | `--paper-green-700`
Not sure a mixin could be appliead in our case...
`--gold-password-input-strength-meter` | Mixin applied to the element | `{}`
-->
<dom-module id="gold-password-input-strength-meter">
  <template>

    <style>
      :host {
        display: inline-block;
        float: right;

        @apply(--paper-font-caption);
        @apply(--gold-password-input-strength-meter);
      }

      :host-context([dir="rtl"]) {
        float: left;
      }

      #strengthTooltip {
        display: block;
      };

      /* check here: http://tutorials.jenkov.com/css/precedence.html */
      :host .None {
        color: var(--gold-password-input-strength-meter-none-color, --paper-grey-700);
      }
      :host .Very.Weak {
        color: var(--gold-password-input-strength-meter-veryweak-color, --paper-red-700);
      }
      :host .Weak {
        color: var(--gold-password-input-strength-meter-weak-color, --paper-orange-700);
      }
      :host .Medium {
        color: var(--gold-password-input-strength-meter-medium-color, --paper-yellow-700);
      }
      :host .Strong {
        color: var(--gold-password-input-strength-meter-strong-color, --paper-blue-700);
      }
      :host .Very.Strong {
        color: var(--gold-password-input-strength-meter-verystrong-color, --paper-green-700);
      }

    </style>

    <span>
      Password strength:
      <span class$=[[_strengthMeterScore]] id="strengthLabel">[[_strengthMeterScore]]</span>
      <paper-tooltip
        id="strengthTooltip"
        for="strengthLabel"
        position="bottom"
        offset="14">
        <!-- TODO: add possible small icons for warning and suggestions... -->
        <div class="warning">
          [[_strengthMeterFeedback.warning]]
        </div>
        <div class="suggestions">
          [[_strengthMeterFeedback.suggestions]]
        </div>
      </paper-tooltip>
    </span>

  </template>
</dom-module>

<script>
  Polymer({
    is: 'gold-password-input-strength-meter',

    behaviors: [
      Polymer.PaperInputAddonBehavior
    ],

    properties: {
      _strengthMeterScore: {
        type: String,
        //notify: true, TODO: check if we need this to update the class...
        value: ''
      },
      _strengthMeterFeedback: {
        type: Object,
        //notify: true, TODO: check if we need this to update the paper-tooltip...
        value: ''
      }
    },

    update: function(state) {
      if (!state.inputElement) {
        return;
      }

      state.value = state.value || '';

      if (state.value === '') {
        this._strengthMeterScore = "None";
        return;
      }

      // Use zxcvbn to evaluate the strength of the password.
      var result = zxcvbn(state.value);

      this._strengthMeterFeedback = result.feedback;
      switch(result.score) {
        case 0:
          this._strengthMeterScore = "Very Weak";
          break;
        case 1:
          this._strengthMeterScore = "Weak";
          break;
        case 2:
          this._strengthMeterScore = "Medium";
          break;
        case 3:
          this._strengthMeterScore = "Strong";
          break;
        case 4:
          this._strengthMeterScore = "Very Strong";
          break;
      }
    }
  });
</script>
